<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: include/Battery.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">Battery.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>API-definition for the battery-module in the BMS-System.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;zephyr/drivers/gpio.h&gt;</code><br />
<code>#include &lt;zephyr/logging/log.h&gt;</code><br />
<code>#include &quot;<a class="el" href="SPI__MB_8h_source.html">SPI_MB.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="CAN__Bus_8h_source.html">CAN_Bus.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="shutdown__circuit_8h_source.html">shutdown_circuit.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="Status__error__flags_8h_source.html">Status_error_flags.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for Battery.h:</div>
<div class="dyncontent">
<div class="center"><img src="Battery_8h__incl.png" border="0" usemap="#ainclude_2Battery_8h" alt=""/></div>
<map name="ainclude_2Battery_8h" id="ainclude_2Battery_8h">
<area shape="rect" title="API&#45;definition for the battery&#45;module in the BMS&#45;System." alt="" coords="415,5,546,31"/>
<area shape="rect" title=" " alt="" coords="180,152,339,177"/>
<area shape="poly" title=" " alt="" coords="444,33,395,53,344,81,308,111,279,143,275,139,304,108,340,76,392,48,442,28"/>
<area shape="rect" title=" " alt="" coords="363,152,518,177"/>
<area shape="poly" title=" " alt="" coords="493,30,512,63,516,84,512,105,496,128,475,146,472,142,492,125,508,103,511,84,507,65,488,32"/>
<area shape="rect" href="SPI__MB_8h.html" title="API&#45;definition for the SPI Module in the BMS&#45;System." alt="" coords="197,79,279,104"/>
<area shape="poly" title=" " alt="" coords="442,33,291,77,289,72,441,28"/>
<area shape="rect" href="CAN__Bus_8h.html" title="API&#45;definition for the Can module in the BMS&#45;System." alt="" coords="573,79,666,104"/>
<area shape="poly" title=" " alt="" coords="497,28,579,70,576,75,495,33"/>
<area shape="rect" href="shutdown__circuit_8h.html" title="API&#45;definition for the shutdown&#45;circuit&#45;module in the BMS&#45;System." alt="" coords="354,79,498,104"/>
<area shape="poly" title=" " alt="" coords="467,33,437,69,433,65,463,29"/>
<area shape="rect" href="Status__error__flags_8h.html" title="Flags for the Battery in the BMS&#45;System." alt="" coords="721,152,872,177"/>
<area shape="poly" title=" " alt="" coords="536,28,606,47,679,76,732,108,775,141,771,145,729,112,677,81,604,52,535,33"/>
<area shape="poly" title=" " alt="" coords="244,104,255,138,249,140,239,105"/>
<area shape="poly" title=" " alt="" coords="271,102,396,145,394,150,270,107"/>
<area shape="rect" title=" " alt="" coords="5,152,156,177"/>
<area shape="poly" title=" " alt="" coords="214,106,120,149,118,144,212,102"/>
<area shape="poly" title=" " alt="" coords="602,81,521,39,523,34,605,76"/>
<area shape="poly" title=" " alt="" coords="592,107,483,149,481,144,590,102"/>
<area shape="rect" title=" " alt="" coords="542,152,697,177"/>
<area shape="poly" title=" " alt="" coords="622,104,622,138,617,138,617,104"/>
<area shape="poly" title=" " alt="" coords="440,77,469,41,473,44,444,80"/>
<area shape="poly" title=" " alt="" coords="400,106,300,149,298,144,398,102"/>
<area shape="poly" title=" " alt="" coords="431,104,438,138,433,139,426,105"/>
<area shape="poly" title=" " alt="" coords="486,101,724,147,723,152,485,107"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="Battery_8h__dep__incl.png" border="0" usemap="#ainclude_2Battery_8hdep" alt=""/></div>
<map name="ainclude_2Battery_8hdep" id="ainclude_2Battery_8hdep">
<area shape="rect" title="API&#45;definition for the battery&#45;module in the BMS&#45;System." alt="" coords="212,5,343,31"/>
<area shape="rect" href="CAN__Bus_8h.html" title="API&#45;definition for the Can module in the BMS&#45;System." alt="" coords="12,79,156,104"/>
<area shape="poly" title=" " alt="" coords="227,38,110,81,108,76,226,33"/>
<area shape="rect" href="shutdown__circuit_8h.html" title="API&#45;definition for the shutdown&#45;circuit&#45;module in the BMS&#45;System." alt="" coords="180,79,375,104"/>
<area shape="poly" title=" " alt="" coords="271,44,273,78,268,79,266,45"/>
<area shape="rect" href="Battery_8c.html" title="Implementation of the Battery Management module for the BMS system." alt="" coords="399,79,585,104"/>
<area shape="poly" title=" " alt="" coords="326,32,458,76,456,81,324,37"/>
<area shape="poly" title=" " alt="" coords="134,72,252,28,254,33,136,77"/>
<area shape="rect" href="CAN__Bus_8c.html" title="CAN Bus communication module for Zephyr RTOS." alt="" coords="5,152,163,192"/>
<area shape="poly" title=" " alt="" coords="87,118,87,152,81,152,81,118"/>
<area shape="poly" title=" " alt="" coords="283,65,282,31,287,31,289,65"/>
</map>
</div>
</div>
<p><a href="Battery_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBatterySystemTypeDef.html">BatterySystemTypeDef</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Battery system state representation.  <a href="structBatterySystemTypeDef.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ade0415fa3de6a77cec873e8209579f65" id="r_ade0415fa3de6a77cec873e8209579f65"><td class="memItemLeft" align="right" valign="top"><a id="ade0415fa3de6a77cec873e8209579f65" name="ade0415fa3de6a77cec873e8209579f65"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MAX_VOLT</b>&#160;&#160;&#160;42000</td></tr>
<tr class="memdesc:ade0415fa3de6a77cec873e8209579f65"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum allowable cell voltage in mV (42000 = 4.2V) <br /></td></tr>
<tr class="separator:ade0415fa3de6a77cec873e8209579f65"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab677a46d3452f6b037d92eb78dcae654" id="r_ab677a46d3452f6b037d92eb78dcae654"><td class="memItemLeft" align="right" valign="top"><a id="ab677a46d3452f6b037d92eb78dcae654" name="ab677a46d3452f6b037d92eb78dcae654"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MIN_VOLT</b>&#160;&#160;&#160;30000</td></tr>
<tr class="memdesc:ab677a46d3452f6b037d92eb78dcae654"><td class="mdescLeft">&#160;</td><td class="mdescRight">Minimum allowable cell voltage in mV (30000 = 3.0V) <br /></td></tr>
<tr class="separator:ab677a46d3452f6b037d92eb78dcae654"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2522d2568f63855838c3ecfb44084710" id="r_a2522d2568f63855838c3ecfb44084710"><td class="memItemLeft" align="right" valign="top"><a id="a2522d2568f63855838c3ecfb44084710" name="a2522d2568f63855838c3ecfb44084710"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MIN_TEMP</b>&#160;&#160;&#160;16725</td></tr>
<tr class="memdesc:a2522d2568f63855838c3ecfb44084710"><td class="mdescLeft">&#160;</td><td class="mdescRight">Minimum raw temperature ADC value (≈ 20 °C) <br /></td></tr>
<tr class="separator:a2522d2568f63855838c3ecfb44084710"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed8ea54a2630aaf2ae3f2bd5fa886959" id="r_aed8ea54a2630aaf2ae3f2bd5fa886959"><td class="memItemLeft" align="right" valign="top"><a id="aed8ea54a2630aaf2ae3f2bd5fa886959" name="aed8ea54a2630aaf2ae3f2bd5fa886959"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MAX_TEMP</b>&#160;&#160;&#160;6115</td></tr>
<tr class="memdesc:aed8ea54a2630aaf2ae3f2bd5fa886959"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum raw temperature ADC value (≈ 60 °C) <br /></td></tr>
<tr class="separator:aed8ea54a2630aaf2ae3f2bd5fa886959"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab42a5c3a3e9680d5f99d284276bd7d50" id="r_ab42a5c3a3e9680d5f99d284276bd7d50"><td class="memItemLeft" align="right" valign="top"><a id="ab42a5c3a3e9680d5f99d284276bd7d50" name="ab42a5c3a3e9680d5f99d284276bd7d50"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>AKKU_CAPACITANCE</b>&#160;&#160;&#160;45000</td></tr>
<tr class="memdesc:ab42a5c3a3e9680d5f99d284276bd7d50"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accumulator capacity in As (45000 = 12.5 Ah) <br /></td></tr>
<tr class="separator:ab42a5c3a3e9680d5f99d284276bd7d50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b2858368e3de5f9b243ea5df3dd4127" id="r_a9b2858368e3de5f9b243ea5df3dd4127"><td class="memItemLeft" align="right" valign="top"><a id="a9b2858368e3de5f9b243ea5df3dd4127" name="a9b2858368e3de5f9b243ea5df3dd4127"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>IVT_TIMEOUT_MS</b>&#160;&#160;&#160;400</td></tr>
<tr class="memdesc:a9b2858368e3de5f9b243ea5df3dd4127"><td class="mdescLeft">&#160;</td><td class="mdescRight">Timeout value for IVT response in milliseconds. <br /></td></tr>
<tr class="separator:a9b2858368e3de5f9b243ea5df3dd4127"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35cf212a4b177ca916afee8ad89249dc" id="r_a35cf212a4b177ca916afee8ad89249dc"><td class="memItemLeft" align="right" valign="top"><a id="a35cf212a4b177ca916afee8ad89249dc" name="a35cf212a4b177ca916afee8ad89249dc"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EVT_ERROR_BIT</b>&#160;&#160;&#160;(1 &lt;&lt; 0)</td></tr>
<tr class="memdesc:a35cf212a4b177ca916afee8ad89249dc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Event bitmask for reporting battery errors. <br /></td></tr>
<tr class="separator:a35cf212a4b177ca916afee8ad89249dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a96004bd7cd7a80ef1f8145c63026a49a" id="r_a96004bd7cd7a80ef1f8145c63026a49a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Battery_8h.html#a96004bd7cd7a80ef1f8145c63026a49a">battery_init</a> (void)</td></tr>
<tr class="memdesc:a96004bd7cd7a80ef1f8145c63026a49a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes GPIOs related to battery feedback and charger sensing.  <br /></td></tr>
<tr class="separator:a96004bd7cd7a80ef1f8145c63026a49a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a804f9a31ed54e56cb175cbfccb440859" id="r_a804f9a31ed54e56cb175cbfccb440859"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Battery_8h.html#a804f9a31ed54e56cb175cbfccb440859">battery_get_status_code</a> (void)</td></tr>
<tr class="memdesc:a804f9a31ed54e56cb175cbfccb440859"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the current status bitfield from the battery system.  <br /></td></tr>
<tr class="separator:a804f9a31ed54e56cb175cbfccb440859"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d2d5ff92bcffda6ddcb8b91990d4026" id="r_a3d2d5ff92bcffda6ddcb8b91990d4026"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Battery_8h.html#a3d2d5ff92bcffda6ddcb8b91990d4026">battery_get_error_code</a> (void)</td></tr>
<tr class="memdesc:a3d2d5ff92bcffda6ddcb8b91990d4026"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the current error bitfield from the battery system.  <br /></td></tr>
<tr class="separator:a3d2d5ff92bcffda6ddcb8b91990d4026"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a778f618f566846d1286db3b4639542c1" id="r_a778f618f566846d1286db3b4639542c1"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Battery_8h.html#a778f618f566846d1286db3b4639542c1">battery_volt2celsius</a> (uint16_t volt_100uV)</td></tr>
<tr class="memdesc:a778f618f566846d1286db3b4639542c1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Converts raw voltage (in 100 µV units) to temperature in °C.  <br /></td></tr>
<tr class="separator:a778f618f566846d1286db3b4639542c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31483142119b07f37b32e84d0d3d1c01" id="r_a31483142119b07f37b32e84d0d3d1c01"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Battery_8h.html#a31483142119b07f37b32e84d0d3d1c01">battery_set_error_flag</a> (uint8_t mask)</td></tr>
<tr class="memdesc:a31483142119b07f37b32e84d0d3d1c01"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets error flags in the battery error field.  <br /></td></tr>
<tr class="separator:a31483142119b07f37b32e84d0d3d1c01"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed529d1573366fac065ace2f85f5546f" id="r_aed529d1573366fac065ace2f85f5546f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Battery_8h.html#aed529d1573366fac065ace2f85f5546f">battery_reset_error_flags</a> (void)</td></tr>
<tr class="memdesc:aed529d1573366fac065ace2f85f5546f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resets all battery error flags to zero.  <br /></td></tr>
<tr class="separator:aed529d1573366fac065ace2f85f5546f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad37e4aaaf5b216f5f9c206fb5bcdb484" id="r_ad37e4aaaf5b216f5f9c206fb5bcdb484"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Battery_8h.html#ad37e4aaaf5b216f5f9c206fb5bcdb484">battery_check_state</a> (void)</td></tr>
<tr class="memdesc:ad37e4aaaf5b216f5f9c206fb5bcdb484"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks for system errors and updates the battery error state accordingly.  <br /></td></tr>
<tr class="separator:ad37e4aaaf5b216f5f9c206fb5bcdb484"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af385b966f1d9efcea35e6f937d05aad5" id="r_af385b966f1d9efcea35e6f937d05aad5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Battery_8h.html#af385b966f1d9efcea35e6f937d05aad5">battery_stop_balancing</a> (void)</td></tr>
<tr class="memdesc:af385b966f1d9efcea35e6f937d05aad5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stops all active cell balancing operations.  <br /></td></tr>
<tr class="separator:af385b966f1d9efcea35e6f937d05aad5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a192bdfe743d2e7e6e203007d2e5972e3" id="r_a192bdfe743d2e7e6e203007d2e5972e3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Battery_8h.html#a192bdfe743d2e7e6e203007d2e5972e3">battery_charging</a> (void)</td></tr>
<tr class="memdesc:a192bdfe743d2e7e6e203007d2e5972e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles the charging logic including balance management.  <br /></td></tr>
<tr class="separator:a192bdfe743d2e7e6e203007d2e5972e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac26d041ed94490f19e6f53c6adddf671" id="r_ac26d041ed94490f19e6f53c6adddf671"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Battery_8h.html#ac26d041ed94490f19e6f53c6adddf671">battery_refresh_ivt_timer</a> (void)</td></tr>
<tr class="memdesc:ac26d041ed94490f19e6f53c6adddf671"><td class="mdescLeft">&#160;</td><td class="mdescRight">Refreshes the IVT (current sensor) watchdog timer.  <br /></td></tr>
<tr class="separator:ac26d041ed94490f19e6f53c6adddf671"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af287da21f3332d6eaf42c4a6f598671a" id="r_af287da21f3332d6eaf42c4a6f598671a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Battery_8h.html#af287da21f3332d6eaf42c4a6f598671a">battery_precharge_logic</a> (void)</td></tr>
<tr class="memdesc:af287da21f3332d6eaf42c4a6f598671a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Executes precharge logic by managing AIR +/- and precharge relays.  <br /></td></tr>
<tr class="separator:af287da21f3332d6eaf42c4a6f598671a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:af3144e669fb7b16c9ce34ef489abaa20" id="r_af3144e669fb7b16c9ce34ef489abaa20"><td class="memItemLeft" align="right" valign="top"><a id="af3144e669fb7b16c9ce34ef489abaa20" name="af3144e669fb7b16c9ce34ef489abaa20"></a>
struct k_event&#160;</td><td class="memItemRight" valign="bottom"><b>error_to_main</b></td></tr>
<tr class="memdesc:af3144e669fb7b16c9ce34ef489abaa20"><td class="mdescLeft">&#160;</td><td class="mdescRight">Event signaling errors to the main control loop. <br /></td></tr>
<tr class="separator:af3144e669fb7b16c9ce34ef489abaa20"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b1be4cc2b733542a67d6010e0718d11" id="r_a1b1be4cc2b733542a67d6010e0718d11"><td class="memItemLeft" align="right" valign="top"><a id="a1b1be4cc2b733542a67d6010e0718d11" name="a1b1be4cc2b733542a67d6010e0718d11"></a>
<a class="el" href="structBatterySystemTypeDef.html">BatterySystemTypeDef</a>&#160;</td><td class="memItemRight" valign="bottom"><b>battery_values</b></td></tr>
<tr class="memdesc:a1b1be4cc2b733542a67d6010e0718d11"><td class="mdescLeft">&#160;</td><td class="mdescRight">Global instance containing the latest battery values. <br /></td></tr>
<tr class="separator:a1b1be4cc2b733542a67d6010e0718d11"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>API-definition for the battery-module in the BMS-System. </p>
<dl class="section author"><dt>Author</dt><dd>renolluc / grossfa2 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>20.04.2025 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a192bdfe743d2e7e6e203007d2e5972e3" name="a192bdfe743d2e7e6e203007d2e5972e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a192bdfe743d2e7e6e203007d2e5972e3">&#9670;&#160;</a></span>battery_charging()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void battery_charging </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Handles the charging logic including balance management. </p>
<p>Handles the charging logic including balance management.</p>
<p>This function must be called periodically (e.g., in the main loop or a timer thread). It first runs the precharge logic, then reads the charger‐connected sense pin.</p>
<p>Active‐low logic:</p><ul>
<li>0 =&gt; charger connected</li>
<li>1 =&gt; charger disconnected</li>
</ul>
<p>If the charger has just connected, it sets the STATUS_CHARGING flag; if already charging, it continues balancing. On disconnect, it clears STATUS_CHARGING, resets the internal temperature, and stops balancing. </p>

</div>
</div>
<a id="ad37e4aaaf5b216f5f9c206fb5bcdb484" name="ad37e4aaaf5b216f5f9c206fb5bcdb484"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad37e4aaaf5b216f5f9c206fb5bcdb484">&#9670;&#160;</a></span>battery_check_state()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int battery_check_state </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Checks for system errors and updates the battery error state accordingly. </p>
<dl class="section return"><dt>Returns</dt><dd>0 if OK, &lt;0 if errors are detected</dd></dl>
<p>Checks for system errors and updates the battery error state accordingly.</p>
<p>This function reads all cell voltages and temperatures, updates error flags on SPI communication failures, computes aggregate metrics, checks for limit violations, and finally refreshes the external SD‑Card interface.</p>
<p>On Zephyr RTOS, all delays and error codes follow POSIX conventions; no HAL types are used. The measurement functions return negative errno on failure, or 0 on success.</p>
<dl class="section return"><dt>Returns</dt><dd>int Current overall system status after SD‑Card refresh. </dd></dl>

</div>
</div>
<a id="a3d2d5ff92bcffda6ddcb8b91990d4026" name="a3d2d5ff92bcffda6ddcb8b91990d4026"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d2d5ff92bcffda6ddcb8b91990d4026">&#9670;&#160;</a></span>battery_get_error_code()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t battery_get_error_code </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieves the current error bitfield from the battery system. </p>
<dl class="section return"><dt>Returns</dt><dd>Battery error code (8-bit)</dd></dl>
<p>Retrieves the current error bitfield from the battery system.</p>
<p>This function returns the internal error bitfield, where each bit represents a specific error condition in the battery management system.</p>
<dl class="section return"><dt>Returns</dt><dd>The 8‑bit error code (bitfield) from battery_values.error. </dd></dl>

</div>
</div>
<a id="a804f9a31ed54e56cb175cbfccb440859" name="a804f9a31ed54e56cb175cbfccb440859"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a804f9a31ed54e56cb175cbfccb440859">&#9670;&#160;</a></span>battery_get_status_code()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t battery_get_status_code </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieves the current status bitfield from the battery system. </p>
<dl class="section return"><dt>Returns</dt><dd>Battery status bitfield (8-bit)</dd></dl>
<p>Retrieves the current status bitfield from the battery system.</p>
<p>Reads the error state, ADBMS internal temperature, and the three GPIO status inputs (AIR positive, AIR negative, Precharge) via Zephyr's GPIO API, and sets or clears the corresponding bits in battery_values.status.</p>
<dl class="section return"><dt>Returns</dt><dd>The current battery status bitfield. </dd></dl>

</div>
</div>
<a id="a96004bd7cd7a80ef1f8145c63026a49a" name="a96004bd7cd7a80ef1f8145c63026a49a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a96004bd7cd7a80ef1f8145c63026a49a">&#9670;&#160;</a></span>battery_init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int battery_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initializes GPIOs related to battery feedback and charger sensing. </p>
<dl class="section return"><dt>Returns</dt><dd>0 on success, negative errno code otherwise.</dd></dl>
<p>Initializes GPIOs related to battery feedback and charger sensing.</p>
<p>Must be called once during system init before reading status.</p>
<dl class="section return"><dt>Returns</dt><dd>0 on success, negative errno otherwise. </dd></dl>

</div>
</div>
<a id="af287da21f3332d6eaf42c4a6f598671a" name="af287da21f3332d6eaf42c4a6f598671a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af287da21f3332d6eaf42c4a6f598671a">&#9670;&#160;</a></span>battery_precharge_logic()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int battery_precharge_logic </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Executes precharge logic by managing AIR +/- and precharge relays. </p>
<dl class="section return"><dt>Returns</dt><dd>0 on successful precharge, &lt;0 if feedback is incorrect</dd></dl>
<p>Executes precharge logic by managing AIR +/- and precharge relays.</p>
<p>This function is called when the Precharge should be enabled It drives the AIR and precharge relays to prepare for charging. </p>

</div>
</div>
<a id="ac26d041ed94490f19e6f53c6adddf671" name="ac26d041ed94490f19e6f53c6adddf671"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac26d041ed94490f19e6f53c6adddf671">&#9670;&#160;</a></span>battery_refresh_ivt_timer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void battery_refresh_ivt_timer </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Refreshes the IVT (current sensor) watchdog timer. </p>
<p>Refreshes the IVT (current sensor) watchdog timer.</p>
<p>This function resets the IVT timer to the current time plus the IVT_TIMEOUT_MS </p>

</div>
</div>
<a id="aed529d1573366fac065ace2f85f5546f" name="aed529d1573366fac065ace2f85f5546f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed529d1573366fac065ace2f85f5546f">&#9670;&#160;</a></span>battery_reset_error_flags()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void battery_reset_error_flags </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Resets all battery error flags to zero. </p>
<p>Resets all battery error flags to zero.</p>
<p>This function resets the internal error bitfield to zero, indicating that no error conditions are currently active. </p>

</div>
</div>
<a id="a31483142119b07f37b32e84d0d3d1c01" name="a31483142119b07f37b32e84d0d3d1c01"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31483142119b07f37b32e84d0d3d1c01">&#9670;&#160;</a></span>battery_set_error_flag()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void battery_set_error_flag </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>mask</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sets error flags in the battery error field. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Bitmask</td><td>(8-bit) representing error flags to set</td></tr>
  </table>
  </dd>
</dl>
<p>Sets error flags in the battery error field.</p>
<p>This function OR‑combines the provided mask into the internal error bitfield, enabling one or more error condition flags while preserving existing ones.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mask</td><td>Bitmask representing the error flags to set. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af385b966f1d9efcea35e6f937d05aad5" name="af385b966f1d9efcea35e6f937d05aad5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af385b966f1d9efcea35e6f937d05aad5">&#9670;&#160;</a></span>battery_stop_balancing()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void battery_stop_balancing </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Stops all active cell balancing operations. </p>
<p>Stops all active cell balancing operations.</p>
<p>This function clears the per‑cell balance mask for every ADBMS client, then issues the updated discharge‑control command to stop all balancing. </p>

</div>
</div>
<a id="a778f618f566846d1286db3b4639542c1" name="a778f618f566846d1286db3b4639542c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a778f618f566846d1286db3b4639542c1">&#9670;&#160;</a></span>battery_volt2celsius()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t battery_volt2celsius </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>volt_100uV</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Converts raw voltage (in 100 µV units) to temperature in °C. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">volt_100uV</td><td>Voltage in units of 100 µV </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Temperature in degrees Celsius</dd></dl>
<p>Converts raw voltage (in 100 µV units) to temperature in °C.</p>
<p>This function applies a 10th‑order calibration polynomial to the input voltage (expressed in units of 100 µV) to compute the corresponding temperature.</p>
<p>Boundary conditions:</p><ul>
<li>If the reading is above 23000 (i.e. &gt; 2.3 V), returns 0 °C.</li>
<li>If the reading is below 2000 (i.e. &lt; 0.2 V), returns 100 °C.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">volt_100uV</td><td>Voltage reading in units of 100 µV. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Temperature in degrees Celsius as an 8‑bit unsigned integer. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
