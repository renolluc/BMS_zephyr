\doxysection{include/\+CAN\+\_\+\+Bus.h File Reference}
\hypertarget{CAN__Bus_8h}{}\label{CAN__Bus_8h}\index{include/CAN\_Bus.h@{include/CAN\_Bus.h}}


API-\/definition for the Can module in the BMS-\/\+System.  


{\ttfamily \#include $<$zephyr/drivers/can.\+h$>$}\newline
{\ttfamily \#include $<$zephyr/logging/log.\+h$>$}\newline
{\ttfamily \#include $<$Battery.\+h$>$}\newline
Include dependency graph for CAN\+\_\+\+Bus.\+h\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{CAN__Bus_8h__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{CAN__Bus_8h__dep__incl}
\end{center}
\end{figure}
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{CAN__Bus_8h_a5b28f59a8b1f738f2d67ddba5b0329ec}\label{CAN__Bus_8h_a5b28f59a8b1f738f2d67ddba5b0329ec} 
\#define {\bfseries CAN\+\_\+\+DEVICE}~DT\+\_\+\+LABEL(DT\+\_\+\+NODELABEL(can1))
\begin{DoxyCompactList}\small\item\em CAN device label for Zephyr device tree. \end{DoxyCompactList}\item 
\Hypertarget{CAN__Bus_8h_ab7b160d326f791e31266f0c50c8bf922}\label{CAN__Bus_8h_ab7b160d326f791e31266f0c50c8bf922} 
\#define {\bfseries TEST\+\_\+\+RXTHREAD\+\_\+\+ID}~0x7\+A0
\begin{DoxyCompactList}\small\item\em Message ID used by RX thread test communication. \end{DoxyCompactList}\item 
\Hypertarget{CAN__Bus_8h_adde9a8f2bf762c5092f27a1269675892}\label{CAN__Bus_8h_adde9a8f2bf762c5092f27a1269675892} 
\#define {\bfseries ADDR\+\_\+\+ECU\+\_\+\+RX}~0x410
\begin{DoxyCompactList}\small\item\em Message ID used for ECU communication. \end{DoxyCompactList}\item 
\Hypertarget{CAN__Bus_8h_a843f1f1bdfd2de9c8645e144f6d9a257}\label{CAN__Bus_8h_a843f1f1bdfd2de9c8645e144f6d9a257} 
\#define {\bfseries ADDR\+\_\+\+ECU\+\_\+\+TX}~0x310
\item 
\Hypertarget{CAN__Bus_8h_ab30245a27b5277580f840dfb0fcf7562}\label{CAN__Bus_8h_ab30245a27b5277580f840dfb0fcf7562} 
\#define {\bfseries IVT\+\_\+\+MSG\+\_\+\+COMMAND}~0x411
\begin{DoxyCompactList}\small\item\em Message ID used for IVT communication. \end{DoxyCompactList}\item 
\Hypertarget{CAN__Bus_8h_a6199c9204680029c43ba902c66e1c96a}\label{CAN__Bus_8h_a6199c9204680029c43ba902c66e1c96a} 
\#define {\bfseries IVT\+\_\+\+MSG\+\_\+\+RESPONSE}~0x511
\item 
\Hypertarget{CAN__Bus_8h_ad146cd6684ccab156a8676d0b9404cdb}\label{CAN__Bus_8h_ad146cd6684ccab156a8676d0b9404cdb} 
\#define {\bfseries IVT\+\_\+\+MSG\+\_\+\+RESULT\+\_\+I}~0x521
\item 
\Hypertarget{CAN__Bus_8h_a2d4c8c99abe98119f2fbcd5a913b7770}\label{CAN__Bus_8h_a2d4c8c99abe98119f2fbcd5a913b7770} 
\#define {\bfseries IVT\+\_\+\+MSG\+\_\+\+RESULT\+\_\+\+U1}~0x522
\item 
\Hypertarget{CAN__Bus_8h_a6b19bc79074186670a5ca35822a4e5fe}\label{CAN__Bus_8h_a6b19bc79074186670a5ca35822a4e5fe} 
\#define {\bfseries IVT\+\_\+\+MSG\+\_\+\+RESULT\+\_\+\+U2}~0x523
\item 
\Hypertarget{CAN__Bus_8h_a54eab94c40a115cc022deb352bc344e3}\label{CAN__Bus_8h_a54eab94c40a115cc022deb352bc344e3} 
\#define {\bfseries IVT\+\_\+\+MSG\+\_\+\+RESULT\+\_\+\+U3}~0x524
\item 
\Hypertarget{CAN__Bus_8h_a31281de09147b6f70841c88bfb37a658}\label{CAN__Bus_8h_a31281de09147b6f70841c88bfb37a658} 
\#define {\bfseries IVT\+\_\+\+MSG\+\_\+\+RESULT\+\_\+T}~0x525
\item 
\Hypertarget{CAN__Bus_8h_a44638383718442686343df98d69ddf4c}\label{CAN__Bus_8h_a44638383718442686343df98d69ddf4c} 
\#define {\bfseries IVT\+\_\+\+MSG\+\_\+\+RESULT\+\_\+W}~0x526
\item 
\Hypertarget{CAN__Bus_8h_ae963af025faaa054aa89c4d1a9fbd833}\label{CAN__Bus_8h_ae963af025faaa054aa89c4d1a9fbd833} 
\#define {\bfseries IVT\+\_\+\+MSG\+\_\+\+RESULT\+\_\+\+AS}~0x527
\item 
\Hypertarget{CAN__Bus_8h_a8c1a9ed140264db0beeb90d8fb037b36}\label{CAN__Bus_8h_a8c1a9ed140264db0beeb90d8fb037b36} 
\#define {\bfseries IVT\+\_\+\+MSG\+\_\+\+RESULT\+\_\+\+WH}~0x528
\item 
\Hypertarget{CAN__Bus_8h_a0e184169d1c375b99092d5ecb74bf207}\label{CAN__Bus_8h_a0e184169d1c375b99092d5ecb74bf207} 
\#define {\bfseries MUX\+\_\+\+RESULTS}~0x00
\item 
\Hypertarget{CAN__Bus_8h_a0fce90cb7c21f4621663ff0fc301dfa2}\label{CAN__Bus_8h_a0fce90cb7c21f4621663ff0fc301dfa2} 
\#define {\bfseries MUX\+\_\+\+SETCANID}~0x10
\item 
\Hypertarget{CAN__Bus_8h_ada969dce05fb792faea5012ebc7fec7b}\label{CAN__Bus_8h_ada969dce05fb792faea5012ebc7fec7b} 
\#define {\bfseries MUX\+\_\+\+SETCONFIG}~0x20
\item 
\Hypertarget{CAN__Bus_8h_add973f7239f916fe1e02545dbbd7fe9c}\label{CAN__Bus_8h_add973f7239f916fe1e02545dbbd7fe9c} 
\#define {\bfseries MUX\+\_\+\+SETCOMMAND}~0x30
\item 
\Hypertarget{CAN__Bus_8h_ad2dc61c5ce88b1ffd81afba4feaad67f}\label{CAN__Bus_8h_ad2dc61c5ce88b1ffd81afba4feaad67f} 
\#define {\bfseries MUX\+\_\+\+GETLOGDATA}~0x40
\item 
\Hypertarget{CAN__Bus_8h_a8fcb330d2d95ecb5867324494bb20225}\label{CAN__Bus_8h_a8fcb330d2d95ecb5867324494bb20225} 
\#define {\bfseries MUX\+\_\+\+GETCANID}~0x50
\item 
\Hypertarget{CAN__Bus_8h_a80e7be065ee33e08653eed30a7a32660}\label{CAN__Bus_8h_a80e7be065ee33e08653eed30a7a32660} 
\#define {\bfseries MUX\+\_\+\+GETCONFIG}~0x60
\item 
\Hypertarget{CAN__Bus_8h_ae0d6632849469d61a0ec4ebcaa0a7e2b}\label{CAN__Bus_8h_ae0d6632849469d61a0ec4ebcaa0a7e2b} 
\#define {\bfseries MUX\+\_\+\+GETCOMMAND}~0x70
\item 
\Hypertarget{CAN__Bus_8h_a591df81ca27037d70c07cacf76ae9890}\label{CAN__Bus_8h_a591df81ca27037d70c07cacf76ae9890} 
\#define {\bfseries MUX\+\_\+\+RESPLOGDATA}~0x80
\item 
\Hypertarget{CAN__Bus_8h_ab3f2521869f441ec6c257b709d247c9c}\label{CAN__Bus_8h_ab3f2521869f441ec6c257b709d247c9c} 
\#define {\bfseries MUX\+\_\+\+RESPCANID}~0x90
\item 
\Hypertarget{CAN__Bus_8h_a77e4f55410dcc247b985e0cf3fafb0b0}\label{CAN__Bus_8h_a77e4f55410dcc247b985e0cf3fafb0b0} 
\#define {\bfseries MUX\+\_\+\+RESPCONFIG}~0x\+A0
\item 
\Hypertarget{CAN__Bus_8h_ac456f48aead54de761416e4a1d0bd9b8}\label{CAN__Bus_8h_ac456f48aead54de761416e4a1d0bd9b8} 
\#define {\bfseries MUX\+\_\+\+RESPSETGET}~0x\+B0
\item 
\Hypertarget{CAN__Bus_8h_a339b17bb36b7152ce157ce8b51a10f37}\label{CAN__Bus_8h_a339b17bb36b7152ce157ce8b51a10f37} 
\#define {\bfseries MUX\+\_\+\+NOTALLOWED}~0x\+FF
\item 
\Hypertarget{CAN__Bus_8h_aa66662897ffe3115a1a3b9481cc8a1b9}\label{CAN__Bus_8h_aa66662897ffe3115a1a3b9481cc8a1b9} 
\#define {\bfseries SET\+\_\+\+MODE}~0x34
\item 
\Hypertarget{CAN__Bus_8h_a7c2e0ea62656ba00921c0cafc2595d2f}\label{CAN__Bus_8h_a7c2e0ea62656ba00921c0cafc2595d2f} 
\#define {\bfseries ISA\+\_\+\+SERIAL\+\_\+\+NUMBER}~10139584
\item 
\Hypertarget{CAN__Bus_8h_a0de4e1dbca8961bad36b9b8d74765c62}\label{CAN__Bus_8h_a0de4e1dbca8961bad36b9b8d74765c62} 
\#define {\bfseries IVT\+\_\+\+NCURRENT}~0
\item 
\Hypertarget{CAN__Bus_8h_a01849db4a832e1af759b4e93afe488c7}\label{CAN__Bus_8h_a01849db4a832e1af759b4e93afe488c7} 
\#define {\bfseries IVT\+\_\+\+NU1}~1
\item 
\Hypertarget{CAN__Bus_8h_a8adfebfb07d91cac1a86561f7553391f}\label{CAN__Bus_8h_a8adfebfb07d91cac1a86561f7553391f} 
\#define {\bfseries IVT\+\_\+\+NU2}~2
\item 
\Hypertarget{CAN__Bus_8h_abc42f47520551c1e7b5a6a2269792980}\label{CAN__Bus_8h_abc42f47520551c1e7b5a6a2269792980} 
\#define {\bfseries IVT\+\_\+\+NU3}~3
\item 
\Hypertarget{CAN__Bus_8h_a238693a2bd25ccbf38219c29d8aa7b0a}\label{CAN__Bus_8h_a238693a2bd25ccbf38219c29d8aa7b0a} 
\#define {\bfseries IVT\+\_\+\+NT}~4
\item 
\Hypertarget{CAN__Bus_8h_afbbd9788a1e36ef04715c29b2d1163a0}\label{CAN__Bus_8h_afbbd9788a1e36ef04715c29b2d1163a0} 
\#define {\bfseries IVT\+\_\+\+NP}~5
\item 
\Hypertarget{CAN__Bus_8h_a81a285faa36efe9893b4ecaac7403889}\label{CAN__Bus_8h_a81a285faa36efe9893b4ecaac7403889} 
\#define {\bfseries IVT\+\_\+\+NQ}~6
\item 
\Hypertarget{CAN__Bus_8h_a88f280278ef2fb2f988fdf6f8e63330f}\label{CAN__Bus_8h_a88f280278ef2fb2f988fdf6f8e63330f} 
\#define {\bfseries IVT\+\_\+\+NE}~7
\item 
\Hypertarget{CAN__Bus_8h_abd5c8ab57c190a6522ccdbf0ed7577da}\label{CAN__Bus_8h_abd5c8ab57c190a6522ccdbf0ed7577da} 
\#define {\bfseries DISABLED}~0
\item 
\Hypertarget{CAN__Bus_8h_aff4a66b1f8644fc427db05953f53b30f}\label{CAN__Bus_8h_aff4a66b1f8644fc427db05953f53b30f} 
\#define {\bfseries TRIGGERED}~1
\item 
\Hypertarget{CAN__Bus_8h_ad32c377f83ed2eec50a09789132bf2bf}\label{CAN__Bus_8h_ad32c377f83ed2eec50a09789132bf2bf} 
\#define {\bfseries CYCLIC}~2
\item 
\Hypertarget{CAN__Bus_8h_aa66b610a521273fbb40b5d6639cc8c39}\label{CAN__Bus_8h_aa66b610a521273fbb40b5d6639cc8c39} 
\#define {\bfseries CYCLETIME}~100
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{CAN__Bus_8h_af3edd29ea29208c6382c65ab3432a2cf}{can\+\_\+init}} (void)
\begin{DoxyCompactList}\small\item\em Initializes CAN controller and receive thread. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{CAN__Bus_8h_a9072758a52bb9e3abffa95c95f00b112}{can\+\_\+send\+\_\+8bytes}} (uint32\+\_\+t address, uint8\+\_\+t \texorpdfstring{$\ast$}{*}Tx\+Buffer)
\begin{DoxyCompactList}\small\item\em Sends an 8-\/byte CAN frame to the specified address. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{CAN__Bus_8h_a12acf8d56fe37b3a0e41d65e623a5222}{can\+\_\+send\+\_\+ivt\+\_\+nbytes}} (uint32\+\_\+t address, uint8\+\_\+t \texorpdfstring{$\ast$}{*}Tx\+Buffer, uint8\+\_\+t length)
\begin{DoxyCompactList}\small\item\em Sends a CAN frame with specified byte length. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{CAN__Bus_8h_ad556ff9329f192a859173a4f1c3e0119}{can\+\_\+send\+\_\+ecu}} (void)
\begin{DoxyCompactList}\small\item\em Formats and sends sensor data to the ECU. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{CAN__Bus_8h_ad8f8973e1390cd3c5cf6754fe36ad4ce}{can\+\_\+get\+\_\+ecu\+\_\+state}} ()
\begin{DoxyCompactList}\small\item\em Checks if the ECU flag is OK or NOK. OK means the accumulator can be connected. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{CAN__Bus_8h_afb8e8566edd5be10e5296c82dce3d5d6}{can\+\_\+ivt\+\_\+init}} (void)
\begin{DoxyCompactList}\small\item\em Initializes IVT sensor with measurement configurations. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{CAN__Bus_8h_aa7a6b9e51ad63f993e7e9634be15489e}\label{CAN__Bus_8h_aa7a6b9e51ad63f993e7e9634be15489e} 
struct k\+\_\+sem {\bfseries test\+\_\+ack\+\_\+sem}
\begin{DoxyCompactList}\small\item\em Semaphore for RX thread test acknowledgment. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
API-\/definition for the Can module in the BMS-\/\+System. 

\begin{DoxyAuthor}{Author}
renolluc / grossfa2 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
20.\+04.\+2025 
\end{DoxyDate}


\doxysubsection{Function Documentation}
\Hypertarget{CAN__Bus_8h_ad8f8973e1390cd3c5cf6754fe36ad4ce}\label{CAN__Bus_8h_ad8f8973e1390cd3c5cf6754fe36ad4ce} 
\index{CAN\_Bus.h@{CAN\_Bus.h}!can\_get\_ecu\_state@{can\_get\_ecu\_state}}
\index{can\_get\_ecu\_state@{can\_get\_ecu\_state}!CAN\_Bus.h@{CAN\_Bus.h}}
\doxysubsubsection{\texorpdfstring{can\_get\_ecu\_state()}{can\_get\_ecu\_state()}}
{\footnotesize\ttfamily int can\+\_\+get\+\_\+ecu\+\_\+state (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [extern]}}



Checks if the ECU flag is OK or NOK. OK means the accumulator can be connected. 

\begin{DoxyReturn}{Returns}
1 if ECU is OK, 0 otherwise. 
\end{DoxyReturn}
\Hypertarget{CAN__Bus_8h_af3edd29ea29208c6382c65ab3432a2cf}\label{CAN__Bus_8h_af3edd29ea29208c6382c65ab3432a2cf} 
\index{CAN\_Bus.h@{CAN\_Bus.h}!can\_init@{can\_init}}
\index{can\_init@{can\_init}!CAN\_Bus.h@{CAN\_Bus.h}}
\doxysubsubsection{\texorpdfstring{can\_init()}{can\_init()}}
{\footnotesize\ttfamily int can\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [extern]}}



Initializes CAN controller and receive thread. 

\begin{DoxyReturn}{Returns}
0 on success, error code otherwise. 
\end{DoxyReturn}
\Hypertarget{CAN__Bus_8h_afb8e8566edd5be10e5296c82dce3d5d6}\label{CAN__Bus_8h_afb8e8566edd5be10e5296c82dce3d5d6} 
\index{CAN\_Bus.h@{CAN\_Bus.h}!can\_ivt\_init@{can\_ivt\_init}}
\index{can\_ivt\_init@{can\_ivt\_init}!CAN\_Bus.h@{CAN\_Bus.h}}
\doxysubsubsection{\texorpdfstring{can\_ivt\_init()}{can\_ivt\_init()}}
{\footnotesize\ttfamily int can\+\_\+ivt\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [extern]}}



Initializes IVT sensor with measurement configurations. 

\begin{DoxyReturn}{Returns}
0 on success, error code otherwise. 
\end{DoxyReturn}
\Hypertarget{CAN__Bus_8h_a9072758a52bb9e3abffa95c95f00b112}\label{CAN__Bus_8h_a9072758a52bb9e3abffa95c95f00b112} 
\index{CAN\_Bus.h@{CAN\_Bus.h}!can\_send\_8bytes@{can\_send\_8bytes}}
\index{can\_send\_8bytes@{can\_send\_8bytes}!CAN\_Bus.h@{CAN\_Bus.h}}
\doxysubsubsection{\texorpdfstring{can\_send\_8bytes()}{can\_send\_8bytes()}}
{\footnotesize\ttfamily int can\+\_\+send\+\_\+8bytes (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{address,  }\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{Tx\+Buffer }\end{DoxyParamCaption})}



Sends an 8-\/byte CAN frame to the specified address. 


\begin{DoxyParams}{Parameters}
{\em address} & Target CAN ID. \\
\hline
{\em Tx\+Buffer} & Pointer to 8-\/byte data buffer. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 on success, error code otherwise. 
\end{DoxyReturn}
\Hypertarget{CAN__Bus_8h_ad556ff9329f192a859173a4f1c3e0119}\label{CAN__Bus_8h_ad556ff9329f192a859173a4f1c3e0119} 
\index{CAN\_Bus.h@{CAN\_Bus.h}!can\_send\_ecu@{can\_send\_ecu}}
\index{can\_send\_ecu@{can\_send\_ecu}!CAN\_Bus.h@{CAN\_Bus.h}}
\doxysubsubsection{\texorpdfstring{can\_send\_ecu()}{can\_send\_ecu()}}
{\footnotesize\ttfamily int can\+\_\+send\+\_\+ecu (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Formats and sends sensor data to the ECU. 


\begin{DoxyParams}{Parameters}
{\em GPIO\+\_\+\+Input} & GPIO input encoding system status. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 on success, error code otherwise. 
\end{DoxyReturn}
\Hypertarget{CAN__Bus_8h_a12acf8d56fe37b3a0e41d65e623a5222}\label{CAN__Bus_8h_a12acf8d56fe37b3a0e41d65e623a5222} 
\index{CAN\_Bus.h@{CAN\_Bus.h}!can\_send\_ivt\_nbytes@{can\_send\_ivt\_nbytes}}
\index{can\_send\_ivt\_nbytes@{can\_send\_ivt\_nbytes}!CAN\_Bus.h@{CAN\_Bus.h}}
\doxysubsubsection{\texorpdfstring{can\_send\_ivt\_nbytes()}{can\_send\_ivt\_nbytes()}}
{\footnotesize\ttfamily int can\+\_\+send\+\_\+ivt\+\_\+nbytes (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{address,  }\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{Tx\+Buffer,  }\item[{uint8\+\_\+t}]{length }\end{DoxyParamCaption})}



Sends a CAN frame with specified byte length. 


\begin{DoxyParams}{Parameters}
{\em address} & Target CAN ID. \\
\hline
{\em Tx\+Buffer} & Pointer to data buffer. \\
\hline
{\em length} & Number of bytes to send. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 on success, error code otherwise. 
\end{DoxyReturn}
