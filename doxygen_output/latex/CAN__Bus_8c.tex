\doxysection{source/modules/\+CAN\+\_\+\+Bus.c File Reference}
\hypertarget{CAN__Bus_8c}{}\label{CAN__Bus_8c}\index{source/modules/CAN\_Bus.c@{source/modules/CAN\_Bus.c}}


CAN Bus communication module for Zephyr RTOS.  


{\ttfamily \#include $<$CAN\+\_\+\+Bus.\+h$>$}\newline
Include dependency graph for CAN\+\_\+\+Bus.\+c\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{CAN__Bus_8c__incl}
\end{center}
\end{figure}
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{CAN__Bus_8c_a20dcfa35841bf5d2d77994f0d7010ea0}\label{CAN__Bus_8c_a20dcfa35841bf5d2d77994f0d7010ea0} 
\#define {\bfseries CAN\+\_\+\+MSG\+\_\+\+ID}~0x123
\item 
\Hypertarget{CAN__Bus_8c_a840217aee9bd887463dad1b56defb051}\label{CAN__Bus_8c_a840217aee9bd887463dad1b56defb051} 
\#define {\bfseries SLEEP\+\_\+\+TIME\+\_\+\+MS}~1000
\item 
\Hypertarget{CAN__Bus_8c_aec9f7026a326aff43c47c6ca55470c57}\label{CAN__Bus_8c_aec9f7026a326aff43c47c6ca55470c57} 
\#define {\bfseries RX\+\_\+\+THREAD\+\_\+\+STACK\+\_\+\+SIZE}~1024
\item 
\Hypertarget{CAN__Bus_8c_a88de7d6b2c458fb84d9538e84dc1701a}\label{CAN__Bus_8c_a88de7d6b2c458fb84d9538e84dc1701a} 
\#define {\bfseries RX\+\_\+\+THREAD\+\_\+\+PRIORITY}~2
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{CAN__Bus_8c_a396e6c13286d4bd20ce71e0399bb237f}{LOG\+\_\+\+MODULE\+\_\+\+REGISTER}} (can, LOG\+\_\+\+LEVEL\+\_\+\+WRN)
\begin{DoxyCompactList}\small\item\em Sets the name and logging levels for this module. \end{DoxyCompactList}\item 
\Hypertarget{CAN__Bus_8c_ac11e2aabe496883a332c7020440fa1de}\label{CAN__Bus_8c_ac11e2aabe496883a332c7020440fa1de} 
{\bfseries K\+\_\+\+THREAD\+\_\+\+STACK\+\_\+\+DEFINE} (can\+\_\+rx\+\_\+thread\+\_\+stack, RX\+\_\+\+THREAD\+\_\+\+STACK\+\_\+\+SIZE)
\item 
\Hypertarget{CAN__Bus_8c_a3cec710778560e52121d8e576cd8f871}\label{CAN__Bus_8c_a3cec710778560e52121d8e576cd8f871} 
{\bfseries CAN\+\_\+\+MSGQ\+\_\+\+DEFINE} (can\+\_\+msgq, 10)
\item 
\Hypertarget{CAN__Bus_8c_a2105b6197c14c0c32b6cf28bb887a0ec}\label{CAN__Bus_8c_a2105b6197c14c0c32b6cf28bb887a0ec} 
void {\bfseries tx\+\_\+irq\+\_\+callback} (const struct device \texorpdfstring{$\ast$}{*}dev, int error, void \texorpdfstring{$\ast$}{*}arg)
\item 
\Hypertarget{CAN__Bus_8c_af681709c4305ccff2a71e31e6038c89b}\label{CAN__Bus_8c_af681709c4305ccff2a71e31e6038c89b} 
void {\bfseries can\+\_\+thread} (void \texorpdfstring{$\ast$}{*}arg1, void \texorpdfstring{$\ast$}{*}arg2, void \texorpdfstring{$\ast$}{*}arg3)
\item 
int \mbox{\hyperlink{CAN__Bus_8c_a9072758a52bb9e3abffa95c95f00b112}{can\+\_\+send\+\_\+8bytes}} (uint32\+\_\+t address, uint8\+\_\+t \texorpdfstring{$\ast$}{*}Tx\+Buffer)
\begin{DoxyCompactList}\small\item\em Sends an 8-\/byte CAN frame to the specified address. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{CAN__Bus_8c_a12acf8d56fe37b3a0e41d65e623a5222}{can\+\_\+send\+\_\+ivt\+\_\+nbytes}} (uint32\+\_\+t address, uint8\+\_\+t \texorpdfstring{$\ast$}{*}Tx\+Buffer, uint8\+\_\+t length)
\begin{DoxyCompactList}\small\item\em Sends a CAN frame with specified byte length. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{CAN__Bus_8c_ad556ff9329f192a859173a4f1c3e0119}{can\+\_\+send\+\_\+ecu}} (void)
\begin{DoxyCompactList}\small\item\em Formats and sends sensor data to the ECU. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{CAN__Bus_8c_a1f193567e6b232db1227d2fb94e8d3d5}{can\+\_\+ivt\+\_\+init}} ()
\begin{DoxyCompactList}\small\item\em Initializes IVT sensor with measurement configurations. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{CAN__Bus_8c_ad8f8973e1390cd3c5cf6754fe36ad4ce}{can\+\_\+get\+\_\+ecu\+\_\+state}} ()
\begin{DoxyCompactList}\small\item\em Checks if the ECU flag is OK or NOK. OK means the accumulator can be connected. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{CAN__Bus_8c_ac5e11e8b1fd506cda57d356153b6f0c0}{can\+\_\+init}} ()
\begin{DoxyCompactList}\small\item\em Initializes CAN controller and receive thread. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{CAN__Bus_8c_a6f0abd5a55e721a1eb8e001f632ddd8f}\label{CAN__Bus_8c_a6f0abd5a55e721a1eb8e001f632ddd8f} 
struct k\+\_\+thread {\bfseries can\+\_\+rx\+\_\+thread\+\_\+data}
\item 
\Hypertarget{CAN__Bus_8c_add82ebb04155365a0fbeac6f1e81d659}\label{CAN__Bus_8c_add82ebb04155365a0fbeac6f1e81d659} 
const struct device \texorpdfstring{$\ast$}{*}const {\bfseries can\+\_\+dev} = DEVICE\+\_\+\+DT\+\_\+\+GET(DT\+\_\+\+CHOSEN(zephyr\+\_\+canbus))
\item 
\Hypertarget{CAN__Bus_8c_aa7a6b9e51ad63f993e7e9634be15489e}\label{CAN__Bus_8c_aa7a6b9e51ad63f993e7e9634be15489e} 
struct k\+\_\+sem {\bfseries test\+\_\+ack\+\_\+sem}
\begin{DoxyCompactList}\small\item\em Semaphore for RX thread test acknowledgment. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
CAN Bus communication module for Zephyr RTOS. 

\begin{DoxyAuthor}{Author}
renolluc / grossfa2 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
20.\+04.\+2025 This file implements functions to initialize and use the CAN interface, send and receive messages, and process responses from IVT and ECU modules. It includes a receiver thread, transmit callback, and utility functions specific to an automotive battery management system. 
\end{DoxyDate}


\doxysubsection{Function Documentation}
\Hypertarget{CAN__Bus_8c_ad8f8973e1390cd3c5cf6754fe36ad4ce}\label{CAN__Bus_8c_ad8f8973e1390cd3c5cf6754fe36ad4ce} 
\index{CAN\_Bus.c@{CAN\_Bus.c}!can\_get\_ecu\_state@{can\_get\_ecu\_state}}
\index{can\_get\_ecu\_state@{can\_get\_ecu\_state}!CAN\_Bus.c@{CAN\_Bus.c}}
\doxysubsubsection{\texorpdfstring{can\_get\_ecu\_state()}{can\_get\_ecu\_state()}}
{\footnotesize\ttfamily int can\+\_\+get\+\_\+ecu\+\_\+state (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Checks if the ECU flag is OK or NOK. OK means the accumulator can be connected. 

\begin{DoxyReturn}{Returns}
1 if ECU is OK, 0 otherwise. 
\end{DoxyReturn}
\Hypertarget{CAN__Bus_8c_ac5e11e8b1fd506cda57d356153b6f0c0}\label{CAN__Bus_8c_ac5e11e8b1fd506cda57d356153b6f0c0} 
\index{CAN\_Bus.c@{CAN\_Bus.c}!can\_init@{can\_init}}
\index{can\_init@{can\_init}!CAN\_Bus.c@{CAN\_Bus.c}}
\doxysubsubsection{\texorpdfstring{can\_init()}{can\_init()}}
{\footnotesize\ttfamily int can\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Initializes CAN controller and receive thread. 

\begin{DoxyReturn}{Returns}
0 on success, error code otherwise. 
\end{DoxyReturn}
\Hypertarget{CAN__Bus_8c_a1f193567e6b232db1227d2fb94e8d3d5}\label{CAN__Bus_8c_a1f193567e6b232db1227d2fb94e8d3d5} 
\index{CAN\_Bus.c@{CAN\_Bus.c}!can\_ivt\_init@{can\_ivt\_init}}
\index{can\_ivt\_init@{can\_ivt\_init}!CAN\_Bus.c@{CAN\_Bus.c}}
\doxysubsubsection{\texorpdfstring{can\_ivt\_init()}{can\_ivt\_init()}}
{\footnotesize\ttfamily int can\+\_\+ivt\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Initializes IVT sensor with measurement configurations. 

\begin{DoxyReturn}{Returns}
0 on success, error code otherwise. 
\end{DoxyReturn}
\Hypertarget{CAN__Bus_8c_a9072758a52bb9e3abffa95c95f00b112}\label{CAN__Bus_8c_a9072758a52bb9e3abffa95c95f00b112} 
\index{CAN\_Bus.c@{CAN\_Bus.c}!can\_send\_8bytes@{can\_send\_8bytes}}
\index{can\_send\_8bytes@{can\_send\_8bytes}!CAN\_Bus.c@{CAN\_Bus.c}}
\doxysubsubsection{\texorpdfstring{can\_send\_8bytes()}{can\_send\_8bytes()}}
{\footnotesize\ttfamily int can\+\_\+send\+\_\+8bytes (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{address,  }\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{Tx\+Buffer }\end{DoxyParamCaption})}



Sends an 8-\/byte CAN frame to the specified address. 


\begin{DoxyParams}{Parameters}
{\em address} & Target CAN ID. \\
\hline
{\em Tx\+Buffer} & Pointer to 8-\/byte data buffer. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 on success, error code otherwise. 
\end{DoxyReturn}
\Hypertarget{CAN__Bus_8c_ad556ff9329f192a859173a4f1c3e0119}\label{CAN__Bus_8c_ad556ff9329f192a859173a4f1c3e0119} 
\index{CAN\_Bus.c@{CAN\_Bus.c}!can\_send\_ecu@{can\_send\_ecu}}
\index{can\_send\_ecu@{can\_send\_ecu}!CAN\_Bus.c@{CAN\_Bus.c}}
\doxysubsubsection{\texorpdfstring{can\_send\_ecu()}{can\_send\_ecu()}}
{\footnotesize\ttfamily int can\+\_\+send\+\_\+ecu (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Formats and sends sensor data to the ECU. 


\begin{DoxyParams}{Parameters}
{\em GPIO\+\_\+\+Input} & GPIO input encoding system status. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 on success, error code otherwise. 
\end{DoxyReturn}
\Hypertarget{CAN__Bus_8c_a12acf8d56fe37b3a0e41d65e623a5222}\label{CAN__Bus_8c_a12acf8d56fe37b3a0e41d65e623a5222} 
\index{CAN\_Bus.c@{CAN\_Bus.c}!can\_send\_ivt\_nbytes@{can\_send\_ivt\_nbytes}}
\index{can\_send\_ivt\_nbytes@{can\_send\_ivt\_nbytes}!CAN\_Bus.c@{CAN\_Bus.c}}
\doxysubsubsection{\texorpdfstring{can\_send\_ivt\_nbytes()}{can\_send\_ivt\_nbytes()}}
{\footnotesize\ttfamily int can\+\_\+send\+\_\+ivt\+\_\+nbytes (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{address,  }\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{Tx\+Buffer,  }\item[{uint8\+\_\+t}]{length }\end{DoxyParamCaption})}



Sends a CAN frame with specified byte length. 


\begin{DoxyParams}{Parameters}
{\em address} & Target CAN ID. \\
\hline
{\em Tx\+Buffer} & Pointer to data buffer. \\
\hline
{\em length} & Number of bytes to send. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 on success, error code otherwise. 
\end{DoxyReturn}
\Hypertarget{CAN__Bus_8c_a396e6c13286d4bd20ce71e0399bb237f}\label{CAN__Bus_8c_a396e6c13286d4bd20ce71e0399bb237f} 
\index{CAN\_Bus.c@{CAN\_Bus.c}!LOG\_MODULE\_REGISTER@{LOG\_MODULE\_REGISTER}}
\index{LOG\_MODULE\_REGISTER@{LOG\_MODULE\_REGISTER}!CAN\_Bus.c@{CAN\_Bus.c}}
\doxysubsubsection{\texorpdfstring{LOG\_MODULE\_REGISTER()}{LOG\_MODULE\_REGISTER()}}
{\footnotesize\ttfamily LOG\+\_\+\+MODULE\+\_\+\+REGISTER (\begin{DoxyParamCaption}\item[{can}]{,  }\item[{LOG\+\_\+\+LEVEL\+\_\+\+WRN}]{ }\end{DoxyParamCaption})}



Sets the name and logging levels for this module. 

Possible log levels\+:
\begin{DoxyItemize}
\item LOG\+\_\+\+LEVEL\+\_\+\+NONE
\item LOG\+\_\+\+LEVEL\+\_\+\+ERR
\item LOG\+\_\+\+LEVEL\+\_\+\+WRN
\item LOG\+\_\+\+LEVEL\+\_\+\+INF
\item LOG\+\_\+\+LEVEL\+\_\+\+DBG 
\end{DoxyItemize}