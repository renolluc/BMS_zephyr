\doxysection{SPI\+\_\+\+MB.\+h}
\hypertarget{SPI__MB_8h_source}{}\label{SPI__MB_8h_source}\index{include/SPI\_MB.h@{include/SPI\_MB.h}}
\mbox{\hyperlink{SPI__MB_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#ifndef\ INC\_SPI\_MB\_H\_}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#define\ INC\_SPI\_MB\_H\_}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{comment}{/*\ Zephyr-\/Framework\ includes\ */}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <zephyr/drivers/spi.h>}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <zephyr/drivers/gpio.h>}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <zephyr/logging/log.h>}}
\DoxyCodeLine{00015\ \textcolor{comment}{/*\ Project\ includes\ */}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{comment}{//\ ADBMS\ Register\ Addresses}}
\DoxyCodeLine{00018\ \textcolor{comment}{//\ DATASHEET\ ADBMS1818\ by\ Analog\ Devices\ p.\ 61}}
\DoxyCodeLine{00019\ \textcolor{comment}{//\ Write\ Configuration\ Register\ Group\ A}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#define\ WRCFGA\ 0x0001}}
\DoxyCodeLine{00021\ \textcolor{comment}{//\ Write\ Configuration\ Register\ Group\ B}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#define\ WRCFGB\ 0x0024}}
\DoxyCodeLine{00023\ \textcolor{comment}{//\ Read\ Configuration\ Register\ Group\ A}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#define\ RDCFGA\ 0x0002}}
\DoxyCodeLine{00025\ \textcolor{comment}{//\ Read\ Configuration\ Register\ Group\ B}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#define\ RDCFGB\ 0x0026}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \textcolor{comment}{//\ Read\ Cell\ Voltage\ Register\ Group\ A}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#define\ RDCVA\ 0x0004}}
\DoxyCodeLine{00031\ \textcolor{comment}{//\ Read\ Cell\ Voltage\ Register\ Group\ B}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#define\ RDCVB\ 0x0006}}
\DoxyCodeLine{00033\ \textcolor{comment}{//\ Read\ Cell\ Voltage\ Register\ Group\ C}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#define\ RDCVC\ 0x0008}}
\DoxyCodeLine{00035\ \textcolor{comment}{//\ Read\ Cell\ Voltage\ Register\ Group\ D}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#define\ RDCVD\ 0x000A}}
\DoxyCodeLine{00037\ \textcolor{comment}{//\ Read\ Cell\ Voltage\ Register\ Group\ E}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#define\ RDCVE\ 0x0009}}
\DoxyCodeLine{00039\ \textcolor{comment}{//\ Read\ Cell\ Voltage\ Register\ Group\ F}}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\#define\ RDCVF\ 0x000B}}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \textcolor{comment}{//\ Read\ Auxiliary\ Register\ Group\ A}}
\DoxyCodeLine{00043\ \textcolor{preprocessor}{\#define\ RDAUXA\ 0x000C}}
\DoxyCodeLine{00044\ \textcolor{comment}{//\ Read\ Auxiliary\ Register\ Group\ B}}
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\#define\ RDAUXB\ 0x000E}}
\DoxyCodeLine{00046\ \textcolor{comment}{//\ Read\ Auxiliary\ Register\ Group\ C}}
\DoxyCodeLine{00047\ \textcolor{preprocessor}{\#define\ RDAUXC\ 0x000D}}
\DoxyCodeLine{00048\ \textcolor{comment}{//\ Read\ Auxiliary\ Register\ Group\ D}}
\DoxyCodeLine{00049\ \textcolor{preprocessor}{\#define\ RDAUXD\ 0x000F}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \textcolor{comment}{//\ Read\ Status\ Register\ Group\ A}}
\DoxyCodeLine{00052\ \textcolor{preprocessor}{\#define\ RDSTATA\ 0x0010}}
\DoxyCodeLine{00053\ \textcolor{comment}{//\ Read\ Status\ Register\ Group\ B}}
\DoxyCodeLine{00054\ \textcolor{preprocessor}{\#define\ RDSTATB\ 0x0012}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \textcolor{comment}{//\ Write\ S\ Control\ Register\ Group}}
\DoxyCodeLine{00057\ \textcolor{preprocessor}{\#define\ WRSCTRL\ 0x0014}}
\DoxyCodeLine{00058\ \textcolor{comment}{//\ Write\ PWM\ Register\ Group}}
\DoxyCodeLine{00059\ \textcolor{preprocessor}{\#define\ WRPWM\ 0x0020}}
\DoxyCodeLine{00060\ \textcolor{comment}{//\ Write\ PWM/S\ Control\ Register\ Group\ B\ }}
\DoxyCodeLine{00061\ \textcolor{preprocessor}{\#define\ WRPSB\ 0x001C}}
\DoxyCodeLine{00062\ \textcolor{comment}{//\ Read\ S\ Control\ Register\ Group}}
\DoxyCodeLine{00063\ \textcolor{preprocessor}{\#define\ RDSCTRL\ 0x0016}}
\DoxyCodeLine{00064\ \textcolor{comment}{//\ Read\ PWM\ Register\ Group}}
\DoxyCodeLine{00065\ \textcolor{preprocessor}{\#define\ RDPWM\ 0x0022}}
\DoxyCodeLine{00066\ \textcolor{comment}{//\ Read\ PWM/S\ Register\ Group}}
\DoxyCodeLine{00067\ \textcolor{preprocessor}{\#define\ RDPSB\ 0x001E}}
\DoxyCodeLine{00068\ \textcolor{comment}{//\ Start\ S\ Control\ Pulsing\ and\ Poll\ Status}}
\DoxyCodeLine{00069\ \textcolor{preprocessor}{\#define\ STSCTRL\ 0x0019}}
\DoxyCodeLine{00070\ \textcolor{comment}{//\ Clear\ S\ Control\ Register\ Group}}
\DoxyCodeLine{00071\ \textcolor{preprocessor}{\#define\ CLRSCTRL\ 0x0018}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \textcolor{comment}{//\ Clear\ Cell\ Voltage\ Register\ Groups}}
\DoxyCodeLine{00074\ \textcolor{preprocessor}{\#define\ CLRCELL\ 0x0711}}
\DoxyCodeLine{00075\ \textcolor{comment}{//\ Clear\ Auxiliary\ Registers\ Groups}}
\DoxyCodeLine{00076\ \textcolor{preprocessor}{\#define\ CLRAUX\ 0x0712}}
\DoxyCodeLine{00077\ \textcolor{comment}{//\ Clear\ Status\ Registers\ Groups}}
\DoxyCodeLine{00078\ \textcolor{preprocessor}{\#define\ CLRSTAT\ 0x0713}}
\DoxyCodeLine{00079\ \textcolor{comment}{//\ Poll\ ADC\ Conversion\ Status}}
\DoxyCodeLine{00080\ \textcolor{preprocessor}{\#define\ PLADC\ 0x0714}}
\DoxyCodeLine{00081\ \textcolor{comment}{//\ Diagnose\ MUX\ and\ Poll\ Status}}
\DoxyCodeLine{00082\ \textcolor{preprocessor}{\#define\ DIAGN\ 0x0715}}
\DoxyCodeLine{00083\ \textcolor{comment}{//\ Write\ Communication\ Register\ Group}}
\DoxyCodeLine{00084\ \textcolor{preprocessor}{\#define\ WRCOMM\ 0x0721}}
\DoxyCodeLine{00085\ \textcolor{comment}{//\ Read\ Communication\ Register\ Group}}
\DoxyCodeLine{00086\ \textcolor{preprocessor}{\#define\ RDCOMM\ 0x0722}}
\DoxyCodeLine{00087\ \textcolor{comment}{//\ Start\ I2C/SPI\ Communication}}
\DoxyCodeLine{00088\ \textcolor{preprocessor}{\#define\ STCOMM\ 0x0723}}
\DoxyCodeLine{00089\ \textcolor{comment}{//\ Mute\ Discharge}}
\DoxyCodeLine{00090\ \textcolor{preprocessor}{\#define\ MUTE\ 0x0028}}
\DoxyCodeLine{00091\ \textcolor{comment}{//\ Unmute\ Discharge}}
\DoxyCodeLine{00092\ \textcolor{preprocessor}{\#define\ UNMUTE\ 0x0029}}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \textcolor{comment}{//\ Start\ Cell\ Voltage\ ADC\ Conversion\ and\ Poll\ Status}}
\DoxyCodeLine{00095\ \textcolor{comment}{//\ 3kHz\ \ Cell,\ all\ Cells}}
\DoxyCodeLine{00096\ \textcolor{preprocessor}{\#define\ ADCV\ 0x0360\ \ \ }}
\DoxyCodeLine{00097\ \textcolor{comment}{//\ Start\ GPIOs\ ADC\ Conversion\ and\ Poll\ Status}}
\DoxyCodeLine{00098\ \textcolor{comment}{//\ 14kHz\ GPIO}}
\DoxyCodeLine{00099\ \textcolor{preprocessor}{\#define\ ADAX\ 0x04E0\ \ \ }}
\DoxyCodeLine{00100\ \textcolor{comment}{//\ Start\ Status\ Group\ ADC\ Conversion\ and\ Poll\ Status}}
\DoxyCodeLine{00101\ \textcolor{comment}{//\ 14kHz\ internal\ Temp}}
\DoxyCodeLine{00102\ \textcolor{preprocessor}{\#define\ ADSTAT\ 0x04EA\ }}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \textcolor{comment}{/*\ Settings\ */}}
\DoxyCodeLine{00106\ \textcolor{preprocessor}{\#define\ NUM\_OF\_CLIENTS\ 8}}
\DoxyCodeLine{00107\ \textcolor{preprocessor}{\#define\ DUMMY\ 0xAA}}
\DoxyCodeLine{00108\ \textcolor{comment}{/*\ Frequency\ in\ Hz\ */}}
\DoxyCodeLine{00109\ \textcolor{preprocessor}{\#define\ SPI\_FREQ\ 1000000}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \textcolor{comment}{//\ Zephyr\ SPI\ device\ binding}}
\DoxyCodeLine{00112\ \textcolor{preprocessor}{\#define\ SPI\_DEVICE\ DT\_NODELABEL(spi1)}}
\DoxyCodeLine{00113\ \textcolor{keyword}{extern}\ \textcolor{keyword}{const}\ \textcolor{keyword}{struct\ }device\ *spi1\_dev;}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keyword}{struct\ }gpio\_dt\_spec\ spi\_cs\_pb1\_spec\ =\ \{}
\DoxyCodeLine{00116\ \ \ \ \ .port\ =\ DEVICE\_DT\_GET(DT\_PARENT(DT\_NODELABEL(spi\_cs\_pb1))),}
\DoxyCodeLine{00117\ \ \ \ \ .pin\ =\ DT\_GPIO\_HOG\_PIN\_BY\_IDX(DT\_NODELABEL(spi\_cs\_pb1),\ 0),}
\DoxyCodeLine{00118\ \ \ \ \ .dt\_flags\ =\ DT\_GPIO\_HOG\_FLAGS\_BY\_IDX(DT\_NODELABEL(spi\_cs\_pb1),\ 0),}
\DoxyCodeLine{00119\ \ \ \};}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \textcolor{keyword}{extern}\ uint16\_t\ \mbox{\hyperlink{SPI__MB_8h_a7e0a7793a9e5ac7288743e6e5ce4b0a6}{spi\_generate\_pec}}(\textcolor{keyword}{const}\ uint8\_t\ data[],\ \textcolor{keywordtype}{size\_t}\ len);}
\DoxyCodeLine{00122\ \textcolor{keyword}{extern}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{SPI__MB_8h_a102d72deeb3ff6c0c9f4a9909e737b49}{spi\_read\_voltages}}(uint16\_t\ *data\_buffer);}
\DoxyCodeLine{00123\ \textcolor{keyword}{extern}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{SPI__MB_8h_ae4d0d93aad30a1cc1056de698bfb6eae}{spi\_read\_temp}}(uint16\_t\ *data\_buffer);}
\DoxyCodeLine{00124\ \textcolor{keyword}{extern}\ uint16\_t\ \mbox{\hyperlink{SPI__MB_8h_a756ec752a2f31def349d63920a309b52}{spi\_read\_adbms\_temp}}();}
\DoxyCodeLine{00125\ \textcolor{keyword}{extern}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{SPI__MB_8h_af2451e5eba282f92947029ee03594821}{spi\_set\_discharge\_cell\_x}}(uint32\_t\ *data\_buffer);}
\DoxyCodeLine{00126\ uint16\_t\ generatePEC(uint8\_t\ data[],\ \textcolor{keywordtype}{size\_t}\ len);}
\DoxyCodeLine{00127\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{SPI__MB_8h_aaa4c99a329e2b7ec6d07e1952ca6c633}{spi\_wake\_up}}();}
\DoxyCodeLine{00128\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{SPI__MB_8h_a59aa2c597ccc26fa3196609668590f67}{spi\_adbms1818\_hw\_init}}();}
\DoxyCodeLine{00129\ \textcolor{keyword}{extern}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{SPI__MB_8h_a5dafc139a3e9ecaf7be453e03ea75465}{spi\_loopback}}();}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ INC\_SPI\_MB\_H\_\ */}\textcolor{preprocessor}{}}

\end{DoxyCode}
